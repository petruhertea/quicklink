################################################################################
# render.yaml â€” QuickLink URL Shortener (Supabase backend)
################################################################################

services:
  - type: web
    name: quicklink-urlshortener
    runtime: docker
    region: frankfurt
    plan: starter

    # Dockerfile handles the build
    buildCommand: ""

    # Health check (Spring Boot Actuator)
    healthCheckPath: /actuator/health

    envVars:
      # --- Supabase ----------------------------------------------------
      - key: SUPABASE_DB_URL
        sync: false

      - key: SUPABASE_DB_URL_DIRECT
        sync: false

      # --- App self URL (used by Stripe, QR, redirects) ----------------
      - key: APP_URL
        fromService:
          type: web
          name: quicklink-urlshortener
          property: oneDeploy

      # --- OAuth -------------------------------------------------------
      - key: GITHUB_CLIENT_ID
        sync: false
      - key: GITHUB_CLIENT_SECRET
        sync: false

      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false

      - key: MICROSOFT_CLIENT_ID
        sync: false
      - key: MICROSOFT_CLIENT_SECRET
        sync: false

      # --- Stripe ------------------------------------------------------
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PRICE_ID
        sync: false

      # --- Spring / HikariCP tuning -----------------------------------
      - key: SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE
        value: "5"

      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: validate
